{"version":3,"sources":["../../src/formats/topo-maps-plus.js"],"names":["format","Style","id","iconUrl","url","stylesFrom","markers","styles","Map","forEach","marker","i","icon","has","set","calTopoJson","Marker","map","m","Array","from","values","style","join","placemark","trim","name","get","coordinates","reverse"],"mappings":";;;;;kBAmBwBA,M;;AAnBxB;;;;;;;;;;IAEMC,K,GACJ,eAAaC,EAAb,EAAiBC,OAAjB,EAA0B;AAAA;;AACxB,OAAKD,EAAL,GAAUA,EAAV;AACA,OAAKE,GAAL,GAAWD,OAAX;AACD,C;;AAGH,SAASE,UAAT,CAAqBC,OAArB,EAA8B;AAC5B,MAAMC,SAAS,IAAIC,GAAJ,EAAf;AACAF,UAAQG,OAAR,CAAgB,UAACC,MAAD,EAASC,CAAT,EAAe;AAC7B,QAAMC,OAAOF,OAAOE,IAAP,EAAb;AACA,QAAIL,OAAOM,GAAP,CAAWD,IAAX,CAAJ,EAAsB;AACtBL,WAAOO,GAAP,CAAWF,IAAX,EAAiB,IAAIX,KAAJ,WAAkBU,CAAlB,EAAuBD,OAAOE,IAAP,EAAvB,CAAjB;AACD,GAJD;AAKA,SAAOL,MAAP;AACD;;AAEc,SAASP,MAAT,CAAiBe,WAAjB,EAA8B;AAC3C,MAAMT,UAAUS,YAAYC,MAAZ,CAAmBC,GAAnB,CAAuB;AAAA,WAAK,qBAAWC,CAAX,CAAL;AAAA,GAAvB,CAAhB;AACA,MAAMX,SAASF,WAAWC,OAAX,CAAf;;AAEA,SAAO,gHAIHa,MAAMC,IAAN,CAAWb,OAAOc,MAAP,EAAX,EAA4BJ,GAA5B,CAAgCK,KAAhC,EAAuCC,IAAvC,CAA4C,EAA5C,CAJG,cAKHjB,QAAQW,GAAR,CAAY;AAAA,WAAKO,UAAUN,CAAV,EAAaX,MAAb,CAAL;AAAA,GAAZ,EAAuCgB,IAAvC,CAA4C,EAA5C,CALG,8BAODE,IAPC,EAAP;AAQD;;AAGD,SAASH,KAAT,CAAgBA,KAAhB,EAAuB;AACrB,+BACeA,MAAMpB,EADrB,+DAIgBoB,MAAMlB,GAJtB;AASD;;AAED,SAASoB,SAAT,CAAoBd,MAApB,EAA4BH,MAA5B,EAAoC;AAClC,6CAEYG,OAAOgB,IAFnB,iCAGgBnB,OAAOoB,GAAP,CAAWjB,OAAOE,IAAP,EAAX,EAA0BV,EAH1C,yDAKqB,6BAAIQ,OAAOkB,WAAP,EAAJ,GAA0BC,OAA1B,GAAoCN,IAApC,CAAyC,GAAzC,CALrB;AASD","file":"topo-maps-plus.js","sourcesContent":["import Marker from '../caltopo/Marker.js';\n\nclass Style {\n  constructor (id, iconUrl) {\n    this.id = id;\n    this.url = iconUrl;\n  }\n}\n\nfunction stylesFrom (markers) {\n  const styles = new Map();\n  markers.forEach((marker, i) => {\n    const icon = marker.icon();\n    if (styles.has(icon)) return;\n    styles.set(icon, new Style(`style${i}`, marker.icon()));\n  });\n  return styles;\n}\n\nexport default function format (calTopoJson) {\n  const markers = calTopoJson.Marker.map(m => new Marker(m));\n  const styles = stylesFrom(markers);\n\n  return `\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<kml xmlns=\"http://www.opengis.net/kml/2.2\">\n  <Document>\n    ${Array.from(styles.values()).map(style).join('')}\n    ${markers.map(m => placemark(m, styles)).join('')}\n  </Document>\n</kml>`.trim();\n}\n\n\nfunction style (style) {\n  return `\n    <Style id=\"${style.id}\">\n      <IconStyle>\n        <Icon>\n          <href>${style.url}</href>\n        </Icon>\n      </IconStyle>\n    </Style>\n  `;\n}\n\nfunction placemark (marker, styles) {\n  return `\n    <Placemark>\n      <name>${marker.name}</name>\n      <styleUrl>${styles.get(marker.icon()).id}</styleUrl>\n      <Point>\n        <coordinates>${[...marker.coordinates()].reverse().join(',')}</coordinates>\n      </Point>\n    </Placemark>  \n  `;\n}\n"]}